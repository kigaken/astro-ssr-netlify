---
import '../styles/global.css'

const title = 'Astro js SSRの実装';

const random = Math.floor(Math.random() * 100);

// 外部APIからデータを取得
const randomInt = (min, max) => {
    // 最小値と最大値を含む範囲でランダムな整数を返す
    min = Math.ceil(min);  // 小数点以下切り上げ
    max = Math.floor(max); // 小数点以下切り捨て
    return Math.floor(Math.random() * (max - min + 1)) + min;
}
const API_URL = `https://jsonplaceholder.typicode.com/users/${randomInt(1, 10)}`;
const res = await fetch(API_URL);
const user = await res.json();

// SSRモードに設定
export const prerender = false;
---
<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>{title}</title>
</head>
<body>
	<div class="container mx-auto pt-8">
		<h1 class="text-2xl bg-blue-100 mb-3 p-1">{title}</h1>

		<h2 class="text-3xl mb-4">SSRページ</h2>

		<section class="pb-10">
			<h3 class="text-lg mb-2 font-bold">乱数（整数）を生成して表示</h3>
			<table class="table-fixed border-collapse border border-gray-300 min-w-[400px]">
				<tbody>
					<tr>
						<th class="text-left p-2 bg-gray-100 w-1/3">乱数</th>
						<td class="p-2 w-auto">{random}</td>
					</tr>
				</tbody>
			</table>
		</section>

		<section class="pb-10">
			<h3 class="text-lg mb-2 font-bold">外部API（https://jsonplaceholder.typicode.com/）からデータを取得して表示</h3>
			<table class="table-fixed border-collapse border border-gray-300 min-w-[400px]">
				<tbody>
					<tr class="border-b border-gray-300">
						<th class="text-left p-2 bg-gray-100 w-1/3">ID</th>
						<td class="text-left p-2">{user.id}</td>
					</tr>
					<tr class="border-b border-gray-300">
						<th class="text-left p-2 bg-gray-100">名前</th>
						<td class="text-left p-2">{user.name}</td>
					</tr>
					<tr class="border-b border-gray-300">
						<th class="text-left p-2 bg-gray-100">ユーザー名</th>
						<td class="text-left p-2">{user.username}</td>
					</tr>
					<tr class="border-b border-gray-300">
						<th class="text-left p-2 bg-gray-100">メールアドレス</th>
						<td class="text-left p-2">{user.email}</td>
					</tr>
				</tbody>
			</table>
		</section>

		<div class="bg-gray-100 p-4 mb-6">
			<p>ポイント</p>
			<ul class="list-disc list-inside">
				<li>SSGならばページを更新しても値が変わらない</li>
				<li>SSRならページを更新する度に変更される</li>
			</ul>
		</div>

		<div class="bg-red-100 p-4">
			<p>注意点</p>
			<ul class="list-disc list-inside">
				<li>npm run devで立ち上げた開発サーバーはSSRが基本</li>
				<li>npm run build、npm run previewで見た時に違いを見ることができる</li>
			</ul>
		</div>

        <nav class="p-4">
            <a href="/" class="text-blue-600 underline">SSRページ</a>
            <a href="/ssg"  class="text-blue-600 underline">SSGページ</a>
        </nav>
	</div>
	<!-- /.container -->	
</body>
</html>

